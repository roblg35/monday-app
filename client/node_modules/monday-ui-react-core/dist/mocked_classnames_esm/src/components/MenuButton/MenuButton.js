import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsx as i,jsxs as n}from"react/jsx-runtime";import r,{forwardRef as t,useRef as s,useState as a,useCallback as d,useMemo as l,useLayoutEffect as c}from"react";import g from"classnames";import p from"../Dialog/Dialog.js";import u from"../DialogContentContainer/DialogContentContainer.js";import m from"../Tooltip/Tooltip.js";import{backwardCompatibilityForProperties as h}from"../../helpers/backwardCompatibilityForProperties.js";import f from"../../hooks/useMergeRefs.js";import{BUTTON_ICON_SIZE as T}from"../Button/ButtonConstants.js";import{MenuButtonSize as C,MenuButtonComponentPosition as E}from"./MenuButtonConstants.js";import{HideShowEvent as v}from"../Dialog/consts/dialog-show-hide-event.js";import{NOOP as S}from"../../utils/function-utils.js";import"./MenuButton.scss.js";import w from"../Icon/Icons/components/Menu.js";import{AnimationType as b}from"../../constants/dialog.js";function j(e){return"menu-button--wrapper--".concat(e)}var O=[m.hideShowTriggers.MOUSE_ENTER],M=[v.CLICK,v.ENTER],P=[],A={main:0,secondary:-6},D=t((function(t,E){var v,N=t.id,y=t.className,I=t.componentClassName,R=t.openDialogComponentClassName,_=t.children,z=t.component,L=void 0===z?w:z,B=t.componentPosition,x=void 0===B?D.componentPositions.START:B,H=t.size,K=void 0===H?C.SMALL:H,U=t.open,k=void 0!==U&&U,F=t.onClick,W=void 0===F?S:F,Y=t.zIndex,X=void 0===Y?null:Y,V=t.ariaLabel,q=void 0===V?"Menu":V,G=t.closeDialogOnContentClick,J=void 0!==G&&G,Q=t.dialogOffset,Z=void 0===Q?A:Q,$=t.dialogPosition,ee=void 0===$?p.positions.BOTTOM_START:$,oe=t.dialogClassName,ie=t.dialogPaddingSize,ne=void 0===ie?u.sizes.MEDIUM:ie,re=t.dialogShowTriggerIgnoreClass,te=t.dialogHideTriggerIgnoreClass,se=t.onMenuHide,ae=void 0===se?S:se,de=t.onMenuShow,le=void 0===de?S:de,ce=t.disabled,ge=void 0!==ce&&ce,pe=t.text,ue=t.tooltipContent,me=t.disabledReason,he=t.tooltipTriggers,fe=void 0===he?[D.hideTriggers.MOUSE_LEAVE]:he,Te=t.tooltipPosition,Ce=void 0===Te?D.dialogPositions.RIGHT:Te,Ee=t.startingEdge,ve=void 0===Ee?"bottom":Ee,Se=t.removeTabCloseTrigger,we=void 0!==Se&&Se,be=t.tooltipReferenceClassName,je=t.hideWhenReferenceHidden,Oe=void 0!==je&&je,Me=t.dialogContainerSelector,Pe=t.active,Ae=s(null),De=f({refs:[E,Ae]}),Ne=a(k),ye=e(Ne,2),Ie=ye[0],Re=ye[1],_e=null!=Pe?Pe:Ie,ze=d((function(e){if(e&&"Escape"===e.key){Re(!1);var o=Ae.current;window.requestAnimationFrame((function(){o.focus()}))}}),[Ae,Re]),Le=d((function(e,o){Re(!1),ae();var i=Ae.current;window.requestAnimationFrame((function(){i&&o===p.hideShowTriggers.ESCAPE_KEY&&i.focus()}))}),[Re,ae,Ae]),Be=d((function(){Re(!0),le()}),[Re,le]),xe=l((function(){var e=new Set([p.hideShowTriggers.CLICK_OUTSIDE,p.hideShowTriggers.TAB_KEY,p.hideShowTriggers.ESCAPE_KEY]);return J&&(e.add(p.hideShowTriggers.CONTENT_CLICK),e.add(p.hideShowTriggers.ENTER)),we&&e.delete(p.hideShowTriggers.TAB_KEY),[r.Children.toArray(_).map((function(o){if(!r.isValidElement(o))return null;var i={};return o.type&&o.type.supportFocusOnMount&&(i.focusOnMount=!0,e.delete(p.hideShowTriggers.ESCAPE_KEY)),o.type&&o.type.isMenu&&(i.onClose=ze),r.cloneElement(o,i)})),Array.from(e)]}),[_,ze,J,we]),He=e(xe,2),Ke=He[0],Ue=He[1],ke=l((function(){return 0===Ke.length?null:i(u,Object.assign({size:ne,type:u.types.POPOVER},{children:Ke}))}),[Ke,ne]),Fe=l((function(){return Object.assign(Object.assign({},A),Z)}),[Z]),We=L,Ye=l((function(){switch(K){case C.XXS:case C.XS:return 16;case C.SMALL:case C.MEDIUM:case C.LARGE:return T;default:return 24}}),[K]),Xe=We?i(We,{size:""+Ye,role:"img","aria-hidden":"true"}):null;c((function(){Re(k)}),[k,Re]);var Ve=h([ue,me]),qe=h([y,I]);return i(m,Object.assign({content:Ve,position:Ce,showTrigger:O,hideTrigger:fe,referenceWrapperClassName:be,hideWhenReferenceHidden:Oe},{children:i(p,Object.assign({wrapperClassName:oe,position:ee,containerSelector:Me,startingEdge:ve,animationType:b.EXPAND,content:ke,moveBy:Fe,showTrigger:ge?P:M,hideTrigger:Ue,showTriggerIgnoreClass:re,hideTriggerIgnoreClass:te,useDerivedStateFromProps:!0,onDialogDidShow:Be,onDialogDidHide:Le,referenceWrapperClassName:j("reference-icon"),zIndex:X,isOpen:Ie,hideWhenReferenceHidden:Oe},{children:n("button",Object.assign({id:N,ref:De,type:"button",className:g("menu-button--wrapper",qe,j("size-".concat(K)),(v={},o(v,j("open"),_e),o(v,R,Ie&&R),o(v,j("disabled"),ge),o(v,j("text"),pe),v)),"aria-haspopup":"true","aria-expanded":Ie,"aria-label":!pe&&q,onMouseUp:function(e){ge?e.currentTarget.blur():W(e)},"aria-disabled":ge},{children:[x===D.componentPositions.START&&Xe,pe&&i("span",Object.assign({className:j("inner-text")},{children:pe})),x===D.componentPositions.END&&Xe]}))}))}))}));Object.assign(D,{sizes:C,paddingSizes:u.sizes,dialogPositions:p.positions,hideTriggers:p.hideShowTriggers,componentPositions:E});var N=D;export{N as default};
