import{slicedToArray as e}from"../../../../_virtual/_rollupPluginBabelHelpers.js";import{jsx as n}from"react/jsx-runtime";import{SIZES as o}from"../../../constants/sizes.js";import s,{forwardRef as t,useRef as i,useState as u,useMemo as r,useEffect as l,useCallback as a,useLayoutEffect as d}from"react";import c from"classnames";import m from"../../../hooks/useMergeRefs.js";import v from"../../../hooks/useClickOutside/index.js";import{backwardCompatibilityForProperties as p}from"../../../helpers/backwardCompatibilityForProperties.js";import b from"./hooks/useSubMenuIndex.js";import f from"./hooks/useOnCloseMenu.js";import M from"./hooks/useCloseMenuOnKeyEvent.js";import I from"./hooks/useMenuKeyboardNavigation.js";import h from"./hooks/useMouseLeave.js";import{useAdjacentSelectableMenuIndex as x}from"./hooks/useAdjacentSelectableMenuIndex.js";import{useFocusWithin as S}from"../../../hooks/useFocusWithin.js";import O from"../../../hooks/usePrevious/index.js";import"./Menu.scss.js";var j=t((function(o,t){var y=o.id,g=o.className,k=o.classname,C=o.size,A=void 0===C?j.sizes.MEDIUM:C,E=o.tabIndex,P=void 0===E?0:E,B=o.ariaLabel,D=void 0===B?"Menu":B,F=o.ariaDescribedBy,L=o.children,N=o.isVisible,V=void 0===N||N,z=o.onClose,T=o.focusOnMount,W=void 0!==T&&T,w=o.focusItemIndex,K=void 0===w?-1:w,R=o.focusItemIndexOnMount,U=void 0===R?-1:R,_=o.isSubMenu,q=void 0!==_&&_,H=o.useDocumentEventListeners,G=void 0!==H&&H,J=o.shouldScrollMenu,Q=void 0!==J&&J,X=i(null),Y=m({refs:[X,t]}),Z=p([g,k]),$=u(K),ee=e($,2),ne=ee[0],oe=ee[1],se=u(!1),te=e(se,2),ie=te[0],ue=te[1],re=r((function(){return s.Children.toArray(L).filter((function(e){return!!e.type.isMenuChild||(console.error("Menu child must be a menuChild item (such as MenuItem, MenuDivider, MenuTitle, etc). This child is not supported: ",e),!1)}))}),[L]);l((function(){y||console.warn("Menu should have a valid id prop")}),[y]);var le=a((function(e){var n,o,t;oe(e);var i=re[e],u=s.isValidElement(i)?(null===(n=null==i?void 0:i.props)||void 0===n?void 0:n.id)||"".concat(y,"-").concat(e):void 0;u?null===(o=null==X?void 0:X.current)||void 0===o||o.setAttribute("aria-activedescendant",u):null===(t=null==X?void 0:X.current)||void 0===t||t.removeAttribute("aria-activedescendant")}),[re,y]),ae=a((function(e){le(e),ue(!1)}),[le]);l((function(){-1!==U&&(le(U),ue(!0))}),[U,le,ue]);var de=b(),ce=de.setSubMenuIsOpenByIndex,me=de.hasOpenSubMenu,ve=de.openSubMenuIndex,pe=de.resetOpenSubMenuIndex,be=f({setActiveItemIndex:ae,setOpenSubMenuIndex:de.setOpenSubMenuIndex,onClose:z});v({ref:X,callback:function(){return be()}}),M({hasOpenSubMenu:me,onCloseMenu:be,ref:X,onClose:z,isSubMenu:q,useDocumentEventListeners:G});var fe=x({children:re}),Me=fe.getNextSelectableIndex,Ie=fe.getPreviousSelectableIndex;I({hasOpenSubMenu:me,getNextSelectableIndex:Me,getPreviousSelectableIndex:Ie,activeItemIndex:ne,setActiveItemIndex:ae,isVisible:V,ref:X,useDocumentEventListeners:G}),h({resetOpenSubMenuIndex:pe,hasOpenSubMenu:me,ref:X,setActiveItemIndex:ae});var he=a((function(){ue(!0)}),[ue]),xe=O(me);l((function(){var e;me||G||ne>-1&&xe&&(null===(e=null==X?void 0:X.current)||void 0===e||e.focus())}),[ne,me,xe,G]),d((function(){W&&!G&&requestAnimationFrame((function(){X&&X.current&&X.current.focus()}))}),[X,W,G]);var Se=S({onBlurWithin:function(){be&&be()}}).focusWithinProps;return n("ul",Object.assign({onFocus:null==Se?void 0:Se.onFocus,onBlur:null==Se?void 0:Se.onBlur,id:y,className:c("monday-style-menu",Z,"monday-style-menu--".concat(A)),ref:Y,tabIndex:P,"aria-label":D,role:"menu","aria-describedby":F,onMouseOver:he},{children:re&&s.Children.map(re,(function(e,n){return s.isValidElement(e)?s.cloneElement(e,Object.assign(Object.assign({},null==e?void 0:e.props),{activeItemIndex:ne,index:n,setActiveItemIndex:le,menuRef:X,resetOpenSubMenuIndex:pe,isParentMenuVisible:V,setSubMenuIsOpenByIndex:ce,hasOpenSubMenu:n===ve,closeMenu:be,menuId:y,useDocumentEventListeners:G,isInitialSelectedState:ie,shouldScrollMenu:Q,getNextSelectableIndex:Me,getPreviousSelectableIndex:Ie,isUnderSubMenu:q})):null}))}))}));Object.assign(j,{isMenu:!0,supportFocusOnMount:!0,sizes:o});var y=j;export{y as default};
