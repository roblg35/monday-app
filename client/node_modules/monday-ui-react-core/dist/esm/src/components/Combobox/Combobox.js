import{slicedToArray as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsxs as e,jsx as i}from"react/jsx-runtime";import{forwardRef as s,useRef as t,useState as n,useCallback as r,useMemo as a}from"react";import{noop as l,isFunction as c}from"lodash-es";import d from"classnames";import{ComponentDefaultTestId as m}from"../../tests/constants.js";import{getTestId as p}from"../../tests/testIds.js";import u from"../../hooks/useMergeRefs.js";import b from"../Search/Search.js";import v from"../Button/Button.js";import f from"./components/ComboboxOption/ComboboxOption.js";import{defaultFilter as g}from"./ComboboxService.js";import{ComboboxItems as h}from"./components/ComboboxItems/ComboboxItems.js";import{StickyCategoryHeader as O}from"./components/StickyCategoryHeader/StickyCategoryHeader.js";import{useItemsData as C,useKeyboardNavigation as x}from"./ComboboxHelpers/ComboboxHelpers.js";import{getOptionId as j}from"./helpers.js";import"./Combobox.scss.js";import{BASE_SIZES as I}from"../../constants/sizes.js";var y=s((function(s,f){var I=s.className,N=void 0===I?"":I,w=s.optionClassName,S=void 0===w?"":w,k=s.searchWrapperClassName,F=s.id,H=void 0===F?"":F,R=s.placeholder,L=void 0===R?"":R,M=s.size,T=void 0===M?y.sizes.MEDIUM:M,z=s.defaultVisualFocusFirstIndex,B=s.optionLineHeight,A=void 0===B?32:B,V=s.optionsListHeight,D=s.autoFocus,E=void 0!==D&&D,W=s.disabled,X=void 0!==W&&W,_=s.options,P=void 0===_?[]:_,U=s.categories,Y=s.withCategoriesDivider,q=void 0!==Y&&Y,G=s.noResultsMessage,J=void 0===G?"No results found":G,K=s.onAddNew,Q=s.addNewLabel,Z=void 0===Q?"Add new":Q,$=s.onClick,oo=void 0===$?function(o){}:$,eo=s.filter,io=void 0===eo?g:eo,so=s.disableFilter,to=void 0!==so&&so,no=s.onFilterChanged,ro=s.loading,ao=void 0!==ro&&ro,lo=s.onOptionHover,co=void 0===lo?l:lo,mo=s.onOptionLeave,po=void 0===mo?l:mo,uo=s.shouldScrollToSelectedItem,bo=void 0===uo||uo,vo=s.noResultsRenderer,fo=s.stickyCategories,go=void 0!==fo&&fo,ho=s.optionRenderer,Oo=void 0===ho?null:ho,Co=s.renderOnlyVisibleOptions,xo=void 0!==Co&&Co,jo=s.clearFilterOnSelection,Io=void 0!==jo&&jo,yo=s.maxOptionsWithoutScroll,No=t(null),wo=t(null),So=n(""),ko=o(So,2),Fo=ko[0],Ho=ko[1],Ro=u({refs:[f,No]}),Lo=r((function(o){no&&no(o),Ho(o)}),[Ho,no]),Mo=r((function(o,e,i){co(o,e,i)}),[co]),To=a((function(){return to?P:io(Fo,P)}),[P,Fo,io,to]),zo=n(-1),Bo=o(zo,2),Ao=Bo[0],Vo=Bo[1],Do=r((function(o){return void 0!==o&&To[o]&&!To[o].disabled}),[To]),Eo=r((function(){K&&K(Fo),Ho("")}),[K,Fo,Ho]),Wo=To.length>0,Xo=Fo.length>0;var _o=n(),Po=o(_o,2),Uo=Po[0],Yo=Po[1],qo=r((function(o){var e,i;(null===(e=null==o?void 0:o.category)||void 0===e?void 0:e.label)!==Uo&&Yo(null===(i=null==o?void 0:o.category)||void 0===i?void 0:i.label)}),[Uo]),Go=C({categories:U,options:To,filterValue:Fo,withCategoriesDivider:q,optionLineHeight:A}),Jo=Go.items,Ko=Go.itemsMap,Qo=Go.selectableItems,Zo=r((function(o,e){oo(Qo[e]),Do(e)&&Vo(e),Io&&Lo("")}),[oo,Qo,Do,Io,Lo]),$o=x({getOptionId:j,defaultVisualFocusFirstIndex:z,onClick:Zo,isChildSelectable:Do,options:Qo,inputRef:wo}),oe=$o.visualFocusItemIndex,ee=$o.visualFocusItemId,ie=$o.onOptionClick;return e("div",Object.assign({ref:Ro,className:d("combobox--wrapper",N,"size-".concat(T),{empty:!Wo,"sticky-category":go}),id:H,"data-testid":p(m.COMBOBOX,H)},{children:[e("div",Object.assign({className:"combobox--wrapper-list",style:{maxHeight:V},role:"listbox"},{children:[i(b,{ref:wo,value:Fo,wrapperClassName:d("combobox--wrapper-search-wrapper",k),className:"combobox--wrapper-search",inputAriaLabel:"Search for content",activeDescendant:ee,id:"combobox-search",placeholder:L,size:T,disabled:X,onChange:Lo,autoFocus:E,loading:ao}),go&&i(O,{label:Uo}),i(h,{categories:U,options:Jo,itemsMap:Ko,optionClassName:S,optionRenderer:Oo,activeItemIndex:Ao,onActiveCategoryChanged:qo,onOptionClick:ie,onOptionEnter:Mo,onOptionLeave:po,optionLineHeight:A,shouldScrollToSelectedItem:bo,renderOnlyVisibleOptions:xo,maxOptionsWithoutScroll:yo,visualFocusItemIndex:oe})]})),Xo&&!Wo&&!ao&&(vo?vo():e("div",Object.assign({className:"combobox--wrapper-no-results"},{children:[i("div",Object.assign({className:"combobox-message-wrapper"},{children:i("span",Object.assign({className:"combobox-message"},{children:J}))})),K&&!X&&i(v,Object.assign({className:"add-new-button",size:T,kind:v.kinds.TERTIARY,onClick:Eo},{children:i("span",Object.assign({className:"button-label"},{children:c(Z)?Z(Fo):Z}))}))]})))]}))}));Object.assign(y,{sizes:I,iconTypes:f.iconTypes,defaultTestId:m.COMBOBOX});var N=y;export{N as default};
