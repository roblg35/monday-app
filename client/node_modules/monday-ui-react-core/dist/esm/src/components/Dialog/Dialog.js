import{inherits as e,createSuper as o,createClass as n,classCallCheck as i,assertThisInitialized as t,toConsumableArray as s}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsxs as a,jsx as r}from"react/jsx-runtime";import{PureComponent as l}from"react";import{createPortal as u}from"react-dom";import{Manager as d,Reference as h,Popper as c}from"react-popper";import{DialogPosition as p}from"../../constants/positions.js";import g from"classnames";import{isFunction as m}from"lodash-es";import{NOOP as f,convertToArray as v,chainFunctions as D}from"../../utils/function-utils.js";import{DialogContent as E}from"./DialogContent/DialogContent.js";import{isInsideClass as y}from"../../utils/dom-utils.js";import{Refable as w}from"../Refable/Refable.js";import{HideShowEvent as C,AnimationType as k}from"../../constants/dialog.js";import"./Dialog.scss.js";var T=function(p){e(D,l);var f=o(D);function D(e){var o;return i(this,D),(o=f.call(this,e)).state={shouldUseDerivedStateFromProps:e.useDerivedStateFromProps,isOpen:e.shouldShowOnMount},o.onMouseEnter=o.onMouseEnter.bind(t(o)),o.onMouseLeave=o.onMouseLeave.bind(t(o)),o.onMouseDown=o.onMouseDown.bind(t(o)),o.onClick=o.onClick.bind(t(o)),o.onFocus=o.onFocus.bind(t(o)),o.onBlur=o.onBlur.bind(t(o)),o.isShown=o.isShown.bind(t(o)),o.onEsc=o.onEsc.bind(t(o)),o.onClickOutside=o.onClickOutside.bind(t(o)),o.onDialogEnter=o.onDialogEnter.bind(t(o)),o.onDialogLeave=o.onDialogLeave.bind(t(o)),o.getContainer=o.getContainer.bind(t(o)),o.onContentClick=o.onContentClick.bind(t(o)),o.onKeyDown=o.onKeyDown.bind(t(o)),o.closeDialogOnEscape=o.closeDialogOnEscape.bind(t(o)),o.hideTimeout=null,o.showTimeout=null,o}return n(D,[{key:"closeDialogOnEscape",value:function(e){if(this.state.isOpen)switch(e.key){case"Escape":this.hideDialogIfNeeded(e,C.ESCAPE_KEY);break;case"Tab":this.handleEvent(C.TAB_KEY,e.target,e);break;case"Enter":this.handleEvent(C.ENTER,e.target,e)}}},{key:"componentDidMount",value:function(){var e=this.props,o=e.shoudlCallbackOnMount,n=e.onDialogDidShow,i=this.state.isOpen;document.addEventListener("keyup",this.closeDialogOnEscape),o&&i&&n&&n()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.closeDialogOnEscape)}},{key:"getContainer",value:function(){var e=this.props.containerSelector;return e&&document.querySelector(e)||document.body}},{key:"showDialog",value:function(){var e=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.props,i=n.showDelay,t=n.instantShowAndHide,s=n.getDynamicShowDelay,a=i,r=o.preventAnimation;if(s){var l=s();a=l.showDelay||0,r=r||l.preventAnimation}t?(this.onShowDialog(),this.setState({isOpen:!0,preventAnimation:r}),this.showTimeout=null):this.showTimeout=setTimeout((function(){e.onShowDialog(),e.showTimeout=null,e.setState({isOpen:!0,preventAnimation:r})}),a)}},{key:"onShowDialog",value:function(){this.isShown()||(0,this.props.onDialogDidShow)()}},{key:"showDialogIfNeeded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.props.disable;o||(this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.showTimeout||this.showDialog(e))}},{key:"hideDialog",value:function(e,o){var n=this,i=this.props,t=i.hideDelay;i.instantShowAndHide?(this.onHideDialog(e,o),this.setState({isOpen:!1}),this.hideTimeout=null):this.hideTimeout=setTimeout((function(){n.onHideDialog(e,o),n.setState({isOpen:!1}),n.hideTimeout=null}),t)}},{key:"onHideDialog",value:function(e,o){var n=this.props.onDialogDidHide;n&&n(e,o)}},{key:"hideDialogIfNeeded",value:function(e,o){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.hideTimeout||this.hideDialog(e,o)}},{key:"handleEvent",value:function(e,o,n){var i=this.props,t=i.showTriggerIgnoreClass,s=i.hideTriggerIgnoreClass;return!this.isShowTrigger(e)||this.isShown()||y(o,t)?this.isHideTrigger(e)&&!y(o,s)?this.hideDialogIfNeeded(n,e):void 0:this.showDialogIfNeeded()}},{key:"isShown",value:function(){return this.state.isOpen||this.props.open}},{key:"isShowTrigger",value:function(e){var o=this.props,n=o.addKeyboardHideShowTriggersByDefault,i=v(o.showTrigger);return!(!n||e!==C.FOCUS||-1>=i.indexOf(C.MOUSE_ENTER))||i.indexOf(e)>-1}},{key:"isHideTrigger",value:function(e){var o=this.props,n=o.addKeyboardHideShowTriggersByDefault,i=v(o.hideTrigger);return!(!n||e!==C.BLUR||-1>=i.indexOf(C.MOUSE_LEAVE))||i.indexOf(e)>-1}},{key:"onMouseEnter",value:function(e){this.handleEvent(C.MOUSE_ENTER,e.target,e)}},{key:"onMouseLeave",value:function(e){this.handleEvent(C.MOUSE_LEAVE,e.target,e)}},{key:"onClick",value:function(e){e.button||this.handleEvent(C.CLICK,e.target,e)}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&this.handleEvent(C.ENTER,e.target,e),"Tab"===e.key&&this.handleEvent(C.TAB_KEY,e.target,e)}},{key:"onMouseDown",value:function(e){e.button||this.handleEvent(C.MOUSE_DOWN,e.target,e)}},{key:"onFocus",value:function(e){this.handleEvent(C.FOCUS,e.target,e)}},{key:"onBlur",value:function(e){this.handleEvent(C.BLUR,e.relatedTarget,e)}},{key:"onEsc",value:function(e){this.handleEvent(C.ESCAPE_KEY,e.target,e)}},{key:"onClickOutside",value:function(e){var o=this.props.onClickOutside;this.handleEvent(C.CLICK_OUTSIDE,e.target,e),o(e)}},{key:"onDialogEnter",value:function(){this.props.showOnDialogEnter&&this.showDialogIfNeeded()}},{key:"onDialogLeave",value:function(e){this.props.showOnDialogEnter&&this.hideDialogIfNeeded(e,"DialogLeave")}},{key:"onContentClick",value:function(e){var o=this.props.onContentClick;this.handleEvent(C.CONTENT_CLICK,e.target,e),o(e)}},{key:"render",value:function(){var e=this,o=this.props,n=o.wrapperClassName,i=o.content,t=o.startingEdge,l=o.children,p=o.preventAnimationOnMount,f=o.animationType,v=o.position,D=o.showDelay,y=o.moveBy,k=o.modifiers,T=o.tooltip,O=o.tooltipClassName,b=o.referenceWrapperClassName,M=o.zIndex,L=o.hideWhenReferenceHidden,N=o.disableContainerScroll,H=o.containerSelector,A=this.state.preventAnimation,I=!this.isHideTrigger(C.CLICK_OUTSIDE),K=p||A?void 0:f,U=m(i)?i():i;return U?a(d,{children:[r(h,{children:function(o){return r(w,Object.assign({className:b,ref:o.ref,onBlur:S("onBlur",e,e.props),onKeyDown:S("onKeyDown",e,e.props),onClick:S("onClick",e,e.props),onFocus:S("onFocus",e,e.props),onMouseDown:S("onMouseDown",e,e.props),onMouseEnter:S("onMouseEnter",e,e.props),onMouseLeave:S("onMouseLeave",e,e.props)},{children:l}))}}),u(r(c,Object.assign({placement:v,modifiers:[{name:"offset",options:{offset:[y.secondary,y.main]}},{name:"zIndex",enabled:!0,phase:"write",fn:function(e){var o=e.state;return M&&(o.styles.popper.zIndex=M+""),o}},{name:"rotator",enabled:!0,phase:"write",fn:function(e){var o=e.state;return o.styles.arrow?(o.styles.arrow.transform="".concat(o.styles.arrow.transform," rotate(45deg)"),o):o}}].concat(s(k))},{children:function(o){var i=o.placement,s=o.style,l=o.ref,u=o.arrowProps,d=o.isReferenceHidden;if(!e.isShown()&&i)return null;if(L&&d){var h=new CustomEvent("onReferenceHidden");e.hideDialog(h,"onReferenceHidden")}return a(E,Object.assign({isReferenceHidden:L&&d,onMouseEnter:e.onDialogEnter,onMouseLeave:e.onDialogLeave,disableOnClickOutside:I,onClickOutside:e.onClickOutside,onEsc:e.onEsc,animationType:K,position:i,wrapperClassName:n,startingEdge:t,isOpen:e.isShown(),showDelay:D,styleObject:s,ref:l,onClick:e.onContentClick,hasTooltip:!!T,containerSelector:H,disableContainerScroll:N},{children:[U,T&&r("div",{style:u.style,ref:u.ref,className:g("monday-style-tooltip-arrow",O),"data-placement":i})]}))}})),this.getContainer())]}):l}}],[{key:"getDerivedStateFromProps",value:function(e,o){return o.shouldUseDerivedStateFromProps?{isOpen:e.isOpen}:null}}]),D}();function S(e,o,n){return D([n[e],o[e]],!0)}T.hideShowTriggers=C,T.positions=p,T.animationTypes=k,T.defaultProps={position:"top",modifiers:[],moveBy:{main:0,secondary:0},showDelay:100,hideDelay:100,showTrigger:T.hideShowTriggers.MOUSE_ENTER,hideTrigger:T.hideShowTriggers.MOUSE_LEAVE,showOnDialogEnter:!1,shouldShowOnMount:!1,disable:!1,open:!1,animationType:T.animationTypes.EXPAND,preventAnimationOnMount:!1,containerSelector:"body",tooltip:!1,onDialogDidShow:f,onDialogDidHide:f,onClickOutside:f,onContentClick:f,useDerivedStateFromProps:!1,hideWhenReferenceHidden:!1,shoudlCallbackOnMount:!1,instantShowAndHide:!1,addKeyboardHideShowTriggersByDefault:!1};export{T as default};
